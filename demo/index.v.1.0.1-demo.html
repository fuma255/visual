<html>

<head>
    <title>Demo of visual</title>
    <style>
        #content {
            margin-top: 60px;
        }
    </style>
    <script src="libs/jquery.min.js"></script>
    <script src="../dist/visual.1.0.1.js"></script>
    <script src="libs/stats.min.js"></script>
</head>

<body>
    <div id="content" style="width:500px; height: 500px; border:1px solid #ccc;"></div>
    <div>
        <input type="text" id="input">
        <button id="canvas2textarea">-></button>
        <button id="textarea2canvas"><-</button>
        <button id="save">save</button>
        <div style="position:absolute; top: 0; right:0; bottom:0; left: 550px">
            <textarea style="width:100%;height:100%;" id="textarea"></textarea>
        </div>
    </div>
    <script>
        let locparms = location.search.slice(1).split('&');
        let param = {}
        locparms.forEach(item => {
            let pa = item.split('=');
            param[pa[0]] = pa[1];
        });
        let api = param.api;
        let dom = document.getElementById('content');
        let v = new Visual(dom);

        let input = document.getElementById('input');
        input.onchange = (e) => {
            $.ajax({
                url: api + '/guidingscreen/screen/detail?id=' + e.target.value,
                dataType: 'JSONP',
                success: (data) => {
                    window.detail = data.data.detail;
                    window.config = JSON.parse(detail.configData);

                    dom.innerHTML = '';
                    dom.style.height = `${config.global.height}px`;
                    dom.style.width = `${config.global.width}px`;
                    v = new Visual(dom);
                    config.components.forEach((item, index) => {
                        if (item.type === 'Road') {
                            item.path.steps.forEach(step => {
                                v.line(step.pixels, {
                                    strokeStyle: '#4df693',
                                    lineWidth: 8
                                });
                            })
                        }
                    })

                }
            })
        }

        let canvas2textarea = document.getElementById('canvas2textarea');
        canvas2textarea.onclick = () => {
            let globalindex = 0;
            config.components.forEach((item, index) => {
                if (item.type === 'Road' && index === 0) {
                    item.path.steps.forEach(step => {
                        step.pixels = v.sys.objects[globalindex].path;
                        globalindex++;
                    })
                }
            })
            document.getElementById('textarea').value = JSON.stringify(config, null, 4);
        }

        let textarea2canvas = document.getElementById('textarea2canvas');
        textarea2canvas.onclick = () => {
            config = JSON.parse(document.getElementById('textarea').value);
            dom.innerHTML = '';
            dom.style.height = `${config.global.height}px`;
            dom.style.width = `${config.global.width}px`;
            v = new Visual(dom);
            config.components.forEach((item, index) => {
                if (item.type === 'Road' && index === 0) {
                    item.path.steps.forEach(step => {
                        v.line(step.pixels, {
                            strokeStyle: '#4df693',
                            lineWidth: 8
                        });
                    })
                }
            })
        }

        let save = document.getElementById('save');
        save.onclick = () => {
            // let globalindex = 0;
            // config.components.forEach((item, index) => {
            //     if (item.type === 'Road') {
            //         item.path.steps.forEach(step => {
            //             step.pixels = v.sys.objects[globalindex].path;
            //             globalindex++;
            //         })
            //     }
            // })
            // console.log(config.components[0].path.steps[0].pixels[0])
            detail.configData = JSON.stringify(config);
            $.ajax({
                url: api + '/guidingscreen/screen/update',
                data: detail,
                dataType: 'JSONP',
                // type: 'POST',
                success: function() {
                    alert('success')
                }
            })
        }
    </script>
    <script>
        // let dom = document.getElementById('content');
        // let v = new Visual(dom);

        // v.line([
        //     [85, 86],
        //     [85, 89],
        //     [85, 104]
        // ], {
        //     strokeStyle: '#4df693',
        //     lineWidth: 20
        // });

        // v.line([
        //     [139, 85],
        //     [197, 85],
        //     [224, 85]
        // ], {
        //     strokeStyle: '#4df693',
        //     lineWidth: 20
        // });

        // let last = v.line([
        //     [10, 10],
        //     [400, 10],
        // ], {
        //     strokeStyle: '#4df693',
        //     lineWidth: 10
        // });

        // last.remove();

        // // v.text('hello', [200, 200]);

        // console.log(v);
    </script>


    <script>
        var stats = new Stats();
        document.body.appendChild(stats.dom);
        requestAnimationFrame(function loop() {
            stats.update();
            requestAnimationFrame(loop)
        });
    </script>
</body>

</html>